(function(){"use strict";angular.module("ngApp",["ngResource","ngRoute"])})();(function(){"use strict";angular.module("ngApp").config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/login",{templateUrl:"/partials/admin/login"}).when("/:league/:season/:team/roster",{templateUrl:"/partials/team/index"}).when("/",{templateUrl:"/partials/home/index"}).otherwise({redirectTo:"/"});$locationProvider.html5Mode(true)}])})();(function(){"use strict";var defaultTimeout=1e4;angular.module("ngApp").factory("RosterService",["$resource",function($resource){return $resource("/api/espnffl/:league/:season/:team/roster",{},{Get:{method:"GET",timeout:defaultTimeout,isArray:false}})}]).factory("EspnFflService",["$resource",function($resource){return $resource("/api/espnffl/:league/:season/:noun",{},{Get:{method:"GET",timeout:defaultTimeout,isArray:false}})}]).factory("UiService",[function($resource){return{current:{leagueId:-1,seasonId:-1,teamId:-1,roster:null,settings:null,members:null,member:null}}}])})();(function(){"use strict";angular.module("ngApp").controller("Master_Controller",["$routeParams","$rootScope","$location","UiService",function($routeParams,$rootScope,$location,UiService){var vm=this;$rootScope.$on("settingsLoaded",function(event,data){vm.settings=UiService.current.settings;vm.settings.leagueName=_(UiService.current.settings.basic).findWhere({key:"LeagueName"}).value});$rootScope.$on("membersLoaded",function(event,data){vm.members=UiService.current.members});$rootScope.$on("memberLoaded",function(event,data){vm.member=UiService.current.member});vm.onMemberSelected=function(member){vm.member=member;$location.path("/"+[$routeParams.league,$routeParams.season,member.team.id,"roster"].join("/"))}}]).controller("Roster_Controller",["$location","$routeParams","$rootScope","$scope","UiService","EspnFflService","RosterService",function($location,$routeParams,$rootScope,$scope,UiService,EspnFflService,RosterService){var vm=this;vm.errors=[];vm.isWorking=true;$scope.$watch("errors",function(){if(vm.errors&&vm.errors.length){vm.isWorking=false}});async.parallel({getRoster:function(callback){RosterService.Get({league:$routeParams.league,season:$routeParams.season,team:$routeParams.team},function(data){return callback(null,data)},function(err){return callback({reason:"Could not retrieve roster information at this time. Please try back later."})})},getSettings:function(callback){if(UiService.current.settings){return callback(null,UiService.current)}EspnFflService.Get({league:$routeParams.league,season:$routeParams.season,noun:"settings"},function(data){return callback(null,data)},function(err){return callback({reason:"Could not retrieve league settings information at this time. Please try back later."})})},getMembers:function(callback){if(UiService.current.members){return callback(null,UiService.current)}EspnFflService.Get({league:$routeParams.league,season:$routeParams.season,noun:"members"},function(data){return callback(null,data)},function(err){return callback({reason:"Could not retrieve league member information at this time. Please try back later."})})}},function(err,results){if(err){vm.errors.push(err);return}vm.team=UiService.current.team=results.getRoster.team;vm.roster=UiService.current.roster=results.getRoster.roster;vm.settings=UiService.current.settings=results.getSettings.settings;vm.members=UiService.current.members=results.getMembers.members;vm.member=UiService.current.member=_(results.getRoster).pick("team","owner");$rootScope.$broadcast("memberLoaded",UiService.current.member);$rootScope.$broadcast("settingsLoaded",UiService.current.settings);$rootScope.$broadcast("membersLoaded",UiService.current.members);vm.populateEmptyRosterSlots(vm.roster.starters,vm.settings);vm.isWorking=false});vm.populateEmptyRosterSlots=function(actualStarters,settings){var starterSlots=_(settings.roster).filter(function(rs){return["QB","RB","RB/WR","TE","LB","DL","DB","K","P","D/ST"].indexOf(rs.key.toUpperCase())>-1});var starterSlotsFilled=_(actualStarters).countBy(function(str){return str.fantasyPosition});var vacancies=_(starterSlots).map(function(ss){var slim=_(ss).pick(["key","name","maximumStarters"]);slim.openings=ss.maximumStarters-(starterSlotsFilled[ss.key]||0);return slim});_(vacancies).each(function(v){for(var i=0;i<v.openings;i++){actualStarters.push({fantasyPosition:v.key})}})};vm.getAdditionalPlayerClasses=function(player,isStarter){var classes=[];if(player.team==="FA"){classes.push("free-agent");classes.push("on-bye-week")}if(!!isStarter&&!player.matchup&&$routeParams.season===(new Date).getFullYear()){classes.push("on-bye-week")}if(classes.length){classes.push("alert-bad-player")}return classes.join(" ")}}])})();(function(){"use strict";angular.module("ngApp").filter("orderByMemberTeamName",[function(){return function(members){return _(members).sortBy(function(m){return m.team&&m.team.name?m.team.name:"ZZZZZZZZZZZZZZZZZ"+m.team.id})}}]).filter("isQB",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="QB".toUpperCase()})}}]).filter("isRB",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="RB".toUpperCase()})}}]).filter("isFlex",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="RB/WR".toUpperCase()})}}]).filter("isWR",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="WR".toUpperCase()})}}]).filter("isTE",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="TE".toUpperCase()})}}]).filter("isLB",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="LB".toUpperCase()})}}]).filter("isDL",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="DL".toUpperCase()})}}]).filter("isDB",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="DB".toUpperCase()})}}]).filter("isK",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="K".toUpperCase()})}}]).filter("isP",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="P".toUpperCase()})}}]).filter("isIR",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="IR".toUpperCase()})}}]).filter("isDST",[function(){return function(players){return _(players).filter(function(player){return player&&player.fantasyPosition&&player.fantasyPosition.toUpperCase()==="D/ST".toUpperCase()})}}])})();$(function(){});function getAverageColourAsRGB(img){var canvas=document.createElement("canvas"),context=canvas.getContext&&canvas.getContext("2d"),rgb={r:102,g:102,b:102},pixelInterval=5,count=0,i=-4,data,length;if(!context){return rgb}var height=canvas.height=img.naturalHeight||img.offsetHeight||img.height,width=canvas.width=img.naturalWidth||img.offsetWidth||img.width;context.drawImage(img,0,0);try{data=context.getImageData(0,0,width,height)}catch(e){alert(e);return rgb}data=data.data;length=data.length;while((i+=pixelInterval*4)<length){count++;rgb.r+=data[i];rgb.g+=data[i+1];rgb.b+=data[i+2]}rgb.r=Math.floor(rgb.r/count);rgb.g=Math.floor(rgb.g/count);rgb.b=Math.floor(rgb.b/count);return rgb}